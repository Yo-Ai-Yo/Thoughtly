<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotional Journaling Facilitator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <!-- Babel CDN for JSX -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <!-- Chart.js CDN for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Confetti CDN for celebrations -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Heroicons CDN for icons -->
    <script src="https://cdn.jsdelivr.net/npm/heroicons@2.1.1/24/outline/esm/index.js"></script>
    <!-- Google Fonts (Poppins) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        /* Animations */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .fade-in-scale {
            animation: fadeInScale 0.3s ease-in-out;
        }
        /* Mood-based backgrounds */
        .bg-happy { background: linear-gradient(to bottom, #ffecd2, #fcb69f); }
        .bg-sad { background: linear-gradient(to bottom, #d1e9ff, #a3cfff); }
        .bg-anxious { background: linear-gradient(to bottom, #e0c3fc, #8ec5fc); }
        .bg-excited { background: linear-gradient(to bottom, #ffcccb, #ff9a9e); }
        .bg-neutral { background: linear-gradient(to bottom, #e2e8f0, #cbd5e1); }
        .dark .bg-happy { background: linear-gradient(to bottom, #d97706, #b91c1c); }
        .dark .bg-sad { background: linear-gradient(to bottom, #1e3a8a, #3b82f6); }
        .dark .bg-anxious { background: linear-gradient(to bottom, #6b21a8, #3b82f6); }
        .dark .bg-excited { background: linear-gradient(to bottom, #b91c1c, #dc2626); }
        .dark .bg-neutral { background: linear-gradient(to bottom, #1e293b, #475569); }
        /* Mobile sidebar transition */
        .sidebar-enter {
            transform: translateX(-100%);
        }
        .sidebar-enter-active {
            transform: translateX(0);
            transition: transform 300ms ease-in-out;
        }
        .sidebar-exit {
            transform: translateX(0);
        }
        .sidebar-exit-active {
            transform: translateX(-100%);
            transition: transform 300ms ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [mood, setMood] = useState("Neutral");
            const [entry, setEntry] = useState("");
            const [followUpResponse, setFollowUpResponse] = useState("");
            const [journalEntries, setJournalEntries] = useState([]);
            const [analysis, setAnalysis] = useState(null);
            const [followUpQuestion, setFollowUpQuestion] = useState("");
            const [followUpAnalysis, setFollowUpAnalysis] = useState(null);
            const [prompt, setPrompt] = useState("Write about how your day went.");
            const [error, setError] = useState("");
            const [sessionStartTime, setSessionStartTime] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [streak, setStreak] = useState(0);
            const [showHistory, setShowHistory] = useState(false);
            const [showTrends, setShowTrends] = useState(false);
            const [showSummary, setShowSummary] = useState(false);
            const [showMoodJournal, setShowMoodJournal] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);

            // Load journal entries and streak from localStorage on mount
            useEffect(() => {
                const savedEntries = localStorage.getItem("journalEntries");
                if (savedEntries) {
                    const entries = JSON.parse(savedEntries);
                    setJournalEntries(entries);
                    calculateStreak(entries);
                }
                setSessionStartTime(new Date());
            }, []);

            // Save journal entries to localStorage whenever they change
            useEffect(() => {
                localStorage.setItem("journalEntries", JSON.stringify(journalEntries));
                calculateStreak(journalEntries);
            }, [journalEntries]);

            // Calculate journaling streak
            const calculateStreak = (entries) => {
                if (entries.length === 0) {
                    setStreak(0);
                    return;
                }
                let currentStreak = 1;
                const sortedEntries = [...entries].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                for (let i = 1; i < sortedEntries.length; i++) {
                    const prevDate = new Date(sortedEntries[i - 1].timestamp);
                    const currDate = new Date(sortedEntries[i].timestamp);
                    const diffDays = (currDate - prevDate) / (1000 * 60 * 60 * 24);
                    if (diffDays <= 1) {
                        currentStreak++;
                    } else {
                        currentStreak = 1;
                    }
                }
                setStreak(currentStreak);
                if (currentStreak === 5 || currentStreak === 10) {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            };

            // Call Awan API with error handling
            const callAwanApi = async (prompt, maxTokens = 100) => {
                try {
                    const response = await fetch("https://api.awanllm.com/v1/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": "Bearer 3b38e8c8-5a6b-4e7e-a373-f85048d14675", // REPLACE WITH YOUR AWAN API KEY
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: "Awanllm-Llama-3-8B-Cumulus",
                            prompt: prompt,
                            max_tokens: maxTokens,
                            temperature: 0.7
                        })
                    });
                    if (response.status === 429) {
                        throw new Error("Rate limit exceeded. Please wait a minute and try again.");
                    }
                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    const data = await response.json();
                    return data.choices[0].text.trim();
                } catch (err) {
                    setError(err.message);
                    return null;
                }
            };

            // Sentiment and emotion analysis using Awan API
            const analyzeSentimentAndEmotion = async (text) => {
                const sentimentPrompt = `Analyze the sentiment of this text: '${text}'. Return one of: positive, negative, or neutral.`;
                const emotionPrompt = `Identify the primary emotion in this text: '${text}' (e.g., joy, sadness, frustration, anxiety).`;
                const sentiment = await callAwanApi(sentimentPrompt, 20) || "neutral";
                const emotion = await callAwanApi(emotionPrompt, 20) || "unknown";
                const emoji = sentiment === "positive" ? "ðŸ˜Š" : sentiment === "negative" ? "ðŸ˜”" : "ðŸ˜";
                return { sentiment, emotion, emoji };
            };

            // Generate a journaling prompt
            const generatePrompt = async () => {
                const lastEntry = journalEntries[journalEntries.length - 1];
                const previousSentiment = lastEntry ? lastEntry.sentiment : null;
                const recurringTheme = await getRecurringThemes();
                let basePrompt = "Generate a thoughtful journaling question for someone reflecting on their emotions today.";
                if (mood) basePrompt += ` They are currently feeling ${mood}.`;
                if (previousSentiment) basePrompt += ` Their last entry had a ${previousSentiment} sentiment.`;
                if (recurringTheme !== "No themes yet.") basePrompt += ` Theyâ€™ve been frequently mentioning the theme of ${recurringTheme}.`;
                const newPrompt = await callAwanApi(basePrompt);
                if (newPrompt) setPrompt(newPrompt);
            };

            // Generate a theme
            const generateTheme = async (entry) => {
                const themePrompt = `Identify the main emotional theme in this journal entry: '${entry}' (e.g., stress, gratitude, loneliness).`;
                return await callAwanApi(themePrompt, 50) || "unknown";
            };

            // Generate an affirmation or gratitude exercise with self-care suggestion
            const generateResponseAndSuggestion = async (sentiment, emotion, theme) => {
                let responsePrompt = `Generate a personalized response for someone whose journal entry has a ${sentiment} sentiment, expresses the emotion of ${emotion}, focuses on the theme of ${theme}, and who is currently feeling ${mood}.`;
                if (sentiment === "negative") {
                    responsePrompt += " Suggest a gratitude exercise to help shift their mindset.";
                } else {
                    responsePrompt += " Provide a positive affirmation to reinforce their emotional state.";
                }
                const response = await callAwanApi(responsePrompt) || "Take a moment to reflect on your feelings.";

                const suggestionPrompt = `Suggest a self-care activity for someone feeling ${emotion} and ${mood.toLowerCase()} with a ${sentiment} sentiment and the theme of ${theme}.`;
                const suggestion = await callAwanApi(suggestionPrompt, 50) || "Try taking a short walk to clear your mind.";
                return { response, suggestion };
            };

            // Generate a follow-up question
            const generateFollowUpQuestion = async (theme, emotion) => {
                const reflectionPrompt = `Generate a follow-up reflection question for someone whose journal entry has the theme of ${theme} and expresses the emotion of ${emotion} to encourage deeper self-reflection.`;
                return await callAwanApi(reflectionPrompt, 100) || "How can you address this feeling moving forward?";
            };

            // Get recurring themes
            const getRecurringThemes = async () => {
                if (journalEntries.length === 0) return "No themes yet.";
                const themes = await Promise.all(journalEntries.map(async (entry) => await generateTheme(entry.entry)));
                const themePrompt = `Identify the most recurring emotional theme in this list: ${themes}.`;
                return await callAwanApi(themePrompt, 50) || "unknown";
            };

            // Analyze trends
            const analyzeTrends = async () => {
                if (journalEntries.length < 2) return "Not enough entries to analyze trends yet.";
                const sentiments = journalEntries.map(entry => entry.sentiment);
                const emotions = journalEntries.map(entry => entry.emotion);
                const themes = await Promise.all(journalEntries.map(async (entry) => await generateTheme(entry.entry)));
                const entriesText = journalEntries.map(entry => entry.entry);
                const trendPrompt = `Analyze this list of sentiments ${sentiments}, emotions ${emotions}, themes ${themes}, and entries ${entriesText}. Provide a detailed summary of the emotional trend, identify a possible trigger for any emotional shifts, and offer one actionable piece of advice.`;
                return await callAwanApi(trendPrompt, 150) || "Unable to analyze trends at this time.";
            };

            // Generate mood journal summary
            const generateMoodJournal = async () => {
                if (journalEntries.length === 0) return "No entries to summarize.";
                const emotions = journalEntries.map(entry => entry.emotion);
                const emotionCount = emotions.reduce((acc, emotion) => {
                    acc[emotion] = (acc[emotion] || 0) + 1;
                    return acc;
                }, {});
                const mostFrequentEmotion = Object.keys(emotionCount).reduce((a, b) => emotionCount[a] > emotionCount[b] ? a : b);
                const summaryPrompt = `Summarize the emotional journey of someone whose journal entries over the past week include these emotions: ${emotions}. Highlight the most frequent emotion (${mostFrequentEmotion}) and suggest a strategy to manage it if negative, or enhance it if positive.`;
                return await callAwanApi(summaryPrompt, 150) || "Unable to generate mood journal summary.";
            };

            // Generate summary email
            const draftSummaryEmail = async () => {
                const entriesToday = journalEntries.filter(entry => 
                    entry.timestamp.startsWith(new Date().toLocaleDateString("en-IN", { timeZone: "Asia/Kolkata" }))
                );
                if (entriesToday.length === 0) return "No entries from today to summarize.";
                const sentiments = entriesToday.map(entry => entry.sentiment);
                const emotions = entriesToday.map(entry => entry.emotion);
                const themes = await Promise.all(entriesToday.map(async (entry) => await generateTheme(entry.entry)));
                const followUps = entriesToday.map(entry => entry.followUpResponse || "None");
                const sessionDuration = (new Date() - sessionStartTime) / (1000 * 60); // in minutes
                const emailPrompt = `Draft a concise email to the user summarizing their journal entries from today. Include the sentiments ${sentiments}, emotions ${emotions}, themes ${themes}, and follow-up responses ${followUps}. Mention they spent ${sessionDuration.toFixed(1)} minutes journaling. Provide a brief reflection in a supportive tone, and end with a motivational quote.`;
                return await callAwanApi(emailPrompt, 250) || "Unable to generate summary email.";
            };

            // Handle entry submission
            const handleSubmit = async () => {
                if (!entry) {
                    setError("Please write an entry before submitting.");
                    return;
                }
                
                setError("");
                const { sentiment, emotion, emoji } = await analyzeSentimentAndEmotion(entry);
                const theme = await generateTheme(entry);
                const { response, suggestion } = await generateResponseAndSuggestion(sentiment, emotion, theme);
                const followUp = await generateFollowUpQuestion(theme, emotion);

                const newEntry = {
                    timestamp: new Date().toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }),
                    mood: mood,
                    entry: entry,
                    sentiment: sentiment,
                    emotion: emotion,
                    emoji: emoji,
                    theme: theme,
                    response: response,
                    suggestion: suggestion
                };

                setJournalEntries([...journalEntries, newEntry]);
                setAnalysis({ sentiment, emotion, emoji, theme, response, suggestion });
                setFollowUpQuestion(followUp);
                setEntry("");
                await generatePrompt();
                setSidebarOpen(false); // Close sidebar on mobile after submitting
            };

            // Handle follow-up submission
            const handleFollowUpSubmit = async () => {
                if (!followUpResponse) {
                    setError("Please provide a follow-up response before submitting.");
                    return;
                }

                setError("");
                const { sentiment, emotion, emoji } = await analyzeSentimentAndEmotion(followUpResponse);
                const feedbackPrompt = `Provide a brief supportive comment for someone who wrote this follow-up response: '${followUpResponse}' with a ${sentiment} sentiment and ${emotion} emotion, related to the theme of ${analysis.theme}.`;
                const feedback = await callAwanApi(feedbackPrompt, 50) || "Thanks for sharing!";

                setFollowUpAnalysis({ sentiment, emotion, emoji, feedback });
                journalEntries[journalEntries.length - 1].followUpResponse = followUpResponse;
                setJournalEntries([...journalEntries]);
                setFollowUpResponse("");
                setFollowUpQuestion("");
                setSidebarOpen(false); // Close sidebar on mobile after submitting
            };

            // Export journal entries
            const exportEntries = () => {
                const exportText = journalEntries.map(entry => 
                    `${entry.timestamp} (Mood: ${entry.mood})\n${entry.entry}\n${entry.followUpResponse ? `Follow-Up: ${entry.followUpResponse}\n` : ""}---\n`
                ).join("");
                const blob = new Blob([exportText], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "journal_entries.txt";
                a.click();
                URL.revokeObjectURL(url);
                setSidebarOpen(false); // Close sidebar on mobile after exporting
            };

            // Clear history
            const clearHistory = () => {
                setJournalEntries([]);
                localStorage.removeItem("journalEntries");
                setShowHistory(false);
                setSidebarOpen(false); // Close sidebar on mobile after clearing
            };

            // Render trends chart
            const renderTrendsChart = () => {
                if (chartInstanceRef.current) {
                    chartInstanceRef.current.destroy();
                }

                const ctx = chartRef.current.getContext("2d");
                const sentiments = journalEntries.map(entry => {
                    if (entry.sentiment === "positive") return 1;
                    if (entry.sentiment === "negative") return -1;
                    return 0;
                });

                chartInstanceRef.current = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: journalEntries.map((_, i) => `Entry ${i + 1}`),
                        datasets: [
                            {
                                label: "Sentiment Trend",
                                data: sentiments,
                                borderColor: "rgba(59, 130, 246, 1)",
                                backgroundColor: "rgba(59, 130, 246, 0.2)",
                                fill: true,
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => {
                                        if (value === 1) return "Positive";
                                        if (value === 0) return "Neutral";
                                        if (value === -1) return "Negative";
                                        return "";
                                    },
                                    stepSize: 1,
                                    font: {
                                        size: window.innerWidth < 640 ? 10 : 12 // Smaller font on mobile
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: window.innerWidth < 640 ? 10 : 12 // Smaller font on mobile
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        size: window.innerWidth < 640 ? 10 : 12 // Smaller font on mobile
                                    }
                                }
                            }
                        }
                    }
                });
            };

            return (
                <div className={`min-h-screen ${darkMode ? "dark" : ""} bg-${mood.toLowerCase()}`}>
                    {/* Hamburger Menu for Mobile */}
                    <div className="md:hidden fixed top-4 left-4 z-50">
                        <button onClick={() => setSidebarOpen(true)} className="text-gray-800 dark:text-gray-200">
                            <svg className="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>

                    {/* Sidebar */}
                    <div className={`fixed inset-y-0 left-0 w-64 bg-blue-800 dark:bg-gray-900 text-white p-4 h-screen transform ${sidebarOpen ? "translate-x-0" : "-translate-x-full"} md:translate-x-0 transition-transform duration-300 ease-in-out z-40`}>
                        <div className="flex justify-between items-center mb-6 md:mb-6">
                            <h1 className="text-xl font-semibold">Journaling Facilitator</h1>
                            <button onClick={() => setSidebarOpen(false)} className="md:hidden text-gray-200">
                                <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div className="mb-6">
                            <div className="flex items-center">
                                <svg className="w-10 h-10 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10" strokeWidth="2"/>
                                    <path d="M12 6v6h4" strokeWidth="2"/>
                                </svg>
                                <div>
                                    <p className="text-sm">Streak</p>
                                    <p className="text-lg font-bold">{streak} days</p>
                                </div>
                            </div>
                        </div>
                        <nav className="space-y-2">
                            <button
                                onClick={() => { setShowHistory(true); setShowTrends(false); setShowSummary(false); setShowMoodJournal(false); setSidebarOpen(false); }}
                                className="w-full flex items-center p-2 rounded-lg hover:bg-blue-700 dark:hover:bg-gray-800 transition"
                            >
                                <svg className="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Past Entries
                            </button>
                            <button
                                onClick={async () => {
                                    setShowTrends(true);
                                    setShowHistory(false);
                                    setShowSummary(false);
                                    setShowMoodJournal(false);
                                    setSidebarOpen(false);
                                    setTimeout(renderTrendsChart, 100);
                                }}
                                className="w-full flex items-center p-2 rounded-lg hover:bg-blue-700 dark:hover:bg-gray-800 transition"
                            >
                                <svg className="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                                Analyze Trends
                            </button>
                            <button
                                onClick={async () => {
                                    setShowSummary(true);
                                    setShowHistory(false);
                                    setShowTrends(false);
                                    setShowMoodJournal(false);
                                    setSidebarOpen(false);
                                    const summary = await draftSummaryEmail();
                                    setAnalysis({ ...analysis, summary });
                                }}
                                className="w-full flex items-center p-2 rounded-lg hover:bg-blue-700 dark:hover:bg-gray-800 transition"
                            >
                                <svg className="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 12H8m4-4v8m-7 4h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Summary Email
                            </button>
                            <button
                                onClick={async () => {
                                    setShowMoodJournal(true);
                                    setShowHistory(false);
                                    setShowTrends(false);
                                    setShowSummary(false);
                                    setSidebarOpen(false);
                                    const moodJournal = await generateMoodJournal();
                                    setAnalysis({ ...analysis, moodJournal });
                                }}
                                className="w-full flex items-center p-2 rounded-lg hover:bg-blue-700 dark:hover:bg-gray-800 transition"
                            >
                                <svg className="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5s3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18s-3.332.477-4.5 1.253" />
                                </svg>
                                Mood Journal
                            </button>
                            <button
                                onClick={() => { setDarkMode(!darkMode); setSidebarOpen(false); }}
                                className="w-full flex items-center p-2 rounded-lg hover:bg-blue-700 dark:hover:bg-gray-800 transition"
                            >
                                <svg className="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                {darkMode ? "Light Mode" : "Dark Mode"}
                            </button>
                        </nav>
                    </div>

                    {/* Overlay for Mobile Sidebar */}
                    {sidebarOpen && (
                        <div 
                            className="md:hidden fixed inset-0 bg-black bg-opacity-50 z-30"
                            onClick={() => setSidebarOpen(false)}
                        ></div>
                    )}

                    {/* Main Content */}
                    <main className="md:ml-64 p-4 md:p-8 flex-1">
                        {/* Error Message */}
                        {error && (
                            <div className="mb-6 p-4 bg-red-100 text-red-700 rounded-lg fade-in-scale">
                                {error}
                            </div>
                        )}

                        {/* Mood Selection */}
                        <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                            <label className="block text-base md:text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">How are you feeling today?</label>
                            <select
                                value={mood}
                                onChange={(e) => setMood(e.target.value)}
                                className="w-full max-w-xs p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600 text-sm md:text-base"
                            >
                                <option value="Happy">Happy</option>
                                <option value="Sad">Sad</option>
                                <option value="Anxious">Anxious</option>
                                <option value="Excited">Excited</option>
                                <option value="Neutral">Neutral</option>
                            </select>
                        </div>

                        {/* Journal Prompt */}
                        <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                            <p className="text-base md:text-lg font-semibold text-gray-800 dark:text-gray-200">Today's Prompt:</p>
                            <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base">{prompt}</p>
                        </div>

                        {/* Journal Entry Input */}
                        <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                            <textarea
                                value={entry}
                                onChange={(e) => setEntry(e.target.value)}
                                placeholder="Write your journal entry here..."
                                className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600 text-sm md:text-base"
                                rows="5"
                            />
                            <button
                                onClick={handleSubmit}
                                className="mt-3 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 w-full md:w-auto text-sm md:text-base"
                            >
                                Submit Entry
                            </button>
                        </div>

                        {/* Analysis Section */}
                        {analysis && (
                            <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                                <h2 className="text-lg md:text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Analysis</h2>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Sentiment:</strong> {analysis.sentiment} {analysis.emoji}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Emotion:</strong> {analysis.emotion}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Main Theme:</strong> {analysis.theme}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>{analysis.sentiment === "negative" ? "Gratitude Exercise" : "Affirmation"}:</strong> {analysis.response}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Self-Care Suggestion:</strong> {analysis.suggestion}</p>
                                {(analysis.theme.toLowerCase() === "stress" || journalEntries.some(e => e.theme.toLowerCase() === "stress")) && (
                                    <p className="mt-2 text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Stress Detected:</strong> Letâ€™s try a quick breathing exercise to reduce stress: Inhale deeply for 4 seconds, hold for 4 seconds, exhale for 4 seconds. Repeat this 3 times. Feel your body relax with each breath.</p>
                                )}
                            </div>
                        )}

                        {/* Follow-Up Question */}
                        {followUpQuestion && (
                            <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                                <p className="text-base md:text-lg font-semibold text-gray-800 dark:text-gray-200">Follow-Up Question:</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base">{followUpQuestion}</p>
                                <textarea
                                    value={followUpResponse}
                                    onChange={(e) => setFollowUpResponse(e.target.value)}
                                    placeholder="Answer the follow-up question here..."
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-2 bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600 text-sm md:text-base"
                                    rows="3"
                                />
                                <button
                                    onClick={handleFollowUpSubmit}
                                    className="mt-3 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 w-full md:w-auto text-sm md:text-base"
                                >
                                    Submit Follow-Up
                                </button>
                            </div>
                        )}

                        {/* Follow-Up Analysis */}
                        {followUpAnalysis && (
                            <div className="mb-6 glass p-4 md:p-6 fade-in-scale">
                                <h2 className="text-lg md:text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Follow-Up Analysis</h2>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Sentiment:</strong> {followUpAnalysis.sentiment} {followUpAnalysis.emoji}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Emotion:</strong> {followUpAnalysis.emotion}</p>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Feedback:</strong> {followUpAnalysis.feedback}</p>
                            </div>
                        )}
                    </main>

                    {/* History Modal */}
                    {showHistory && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto fade-in-scale m-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-200">Past Entries</h2>
                                    <button onClick={() => setShowHistory(false)} className="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                        <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                {journalEntries.length === 0 ? (
                                    <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base">No entries yet.</p>
                                ) : (
                                    <div className="space-y-4">
                                        {journalEntries.map((entry, index) => (
                                            <div key={index} className="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                                <p className="text-gray-800 dark:text-gray-200 text-sm md:text-base"><strong>{entry.timestamp}</strong> (Mood: {entry.mood})</p>
                                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base">{entry.entry}</p>
                                                {entry.followUpResponse && (
                                                    <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base"><strong>Follow-Up:</strong> {entry.followUpResponse}</p>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4 mt-4">
                                    <button
                                        onClick={exportEntries}
                                        className="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition transform hover:scale-105 w-full md:w-auto text-sm md:text-base"
                                    >
                                        Export Entries
                                    </button>
                                    <button
                                        onClick={clearHistory}
                                        className="bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition transform hover:scale-105 w-full md:w-auto text-sm md:text-base"
                                    >
                                        Clear History
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Trends Modal */}
                    {showTrends && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto fade-in-scale m-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-200">Emotional Trends</h2>
                                    <button onClick={() => setShowTrends(false)} className="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                        <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <canvas ref={chartRef} className="mb-4 w-full" style={{ maxHeight: window.innerWidth < 640 ? "200px" : "300px" }}></canvas>
                                <p className="text-gray-700 dark:text-gray-300 text-sm md:text-base">{journalEntries.length < 2 ? "Not enough entries to analyze trends." : "Sentiment trend over time."}</p>
                            </div>
                        </div>
                    )}

                    {/* Summary Modal */}
                    {showSummary && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto fade-in-scale m-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-200">Daily Summary Email</h2>
                                    <button onClick={() => setShowSummary(false)} className="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                        <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p className="whitespace-pre-wrap text-gray-700 dark:text-gray-300 text-sm md:text-base">{analysis?.summary || "Generating summary..."}</p>
                            </div>
                        </div>
                    )}

                    {/* Mood Journal Modal */}
                    {showMoodJournal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto fade-in-scale m-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-200">Mood Journal Summary</h2>
                                    <button onClick={() => setShowMoodJournal(false)} className="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                        <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p className="whitespace-pre-wrap text-gray-700 dark:text-gray-300 text-sm md:text-base">{analysis?.moodJournal || "Generating mood journal summary..."}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
